/**
 * @file Core0.c
 * @generated by CPrinter
 * @date Mon Aug 12 12:22:03 CEST 2019
 *
 * Code generated for processing element Core0 (ID=0).
 */

#include "preesm_gen.h"
// Core Global Declaration
extern pthread_barrier_t iter_barrier;
extern int stopThreads;

// Core Global Definitions
char Shared[270766848]; //  size:= 270766848*char
char *const read_parameters__kmeansClust__0 = (char*) (Shared+0);  // read_parameters > kmeansCluster_BroadcastHsImage size:= 135376896*char
char *const kmeansCluster_BroadcastHsIma__0 = (char*) (Shared+0);  // kmeansCluster_BroadcastHsImage > kmeansCluster_initializeCluster size:= 135376896*char
char *const kmeansCluster_BroadcastHsIma__1 = (char*) (Shared+135376896);  // kmeansCluster_BroadcastHsImage > kmeansCluster_kmeansfunction size:= 135376896*char
char *const kmeansCluster_kmeansfunction__0 = (char*) (Shared+0);  // kmeansCluster_kmeansfunction > write_results size:= 1057632*char
char *const kmeansCluster_initializeClus__0 = (char*) (Shared+270753792);  // kmeansCluster_initializeCluster > kmeansCluster_BroadcastClusterCentroids size:= 12288*char
char *const kmeansCluster_BroadcastClust__0 = (char*) (Shared+270753792);  // kmeansCluster_BroadcastClusterCentroids > kmeansCluster_error size:= 12288*char
char *const kmeansCluster_BroadcastClust__1 = (char*) (Shared+1057632);  // kmeansCluster_BroadcastClusterCentroids > kmeansCluster_kmeansfunction size:= 12288*char
char *const read_parameters__kmeansClust__1 = (char*) (Shared+270766080);  // read_parameters > kmeansCluster_BroadcastStruck size:= 256*char
char *const kmeansCluster_BroadcastStruc__0 = (char*) (Shared+270766080);  // kmeansCluster_BroadcastStruck > kmeansCluster_initializeCluster size:= 256*char
char *const kmeansCluster_BroadcastStruc__1 = (char*) (Shared+270766336);  // kmeansCluster_BroadcastStruck > kmeansCluster_kmeansfunction size:= 256*char
char *const kmeansCluster_BroadcastStruc__2 = (char*) (Shared+270766592);  // kmeansCluster_BroadcastStruck > kmeansCluster_error size:= 256*char
char *const kmeansCluster_error__kmeansC__0 = (char*) (Shared+1069920);  // kmeansCluster_error > kmeansCluster_kmeansfunction size:= 16*char
float *const image__image__0 = (float*) (Shared+0);  // read_parameters_image > kmeansCluster_BroadcastHsImage_image size:= 33844224*float
float *const imageInitialization_0_0__ima__0 = (float*) (Shared+0);  // kmeansCluster_BroadcastHsImage_imageInitialization_0_0 > kmeansCluster_initializeCluster_image size:= 33844224*float
float *const imageKmeans_33844224_0__imag__0 = (float*) (Shared+135376896);  // kmeansCluster_BroadcastHsImage_imageKmeans_33844224_0 > kmeansCluster_kmeansfunction_image size:= 33844224*float
int *const assignedCluster__assignedClu__0 = (int*) (Shared+0);  // kmeansCluster_kmeansfunction_assignedCluster > write_results_assignedCluster size:= 264408*int
float *const clusterCentroids__clusterCen__0 = (float*) (Shared+270753792);  // kmeansCluster_initializeCluster_clusterCentroids > kmeansCluster_BroadcastClusterCentroids_clusterCentroids size:= 3072*float
float *const clusterCentroidsError_3072_0__0 = (float*) (Shared+270753792);  // kmeansCluster_BroadcastClusterCentroids_clusterCentroidsError_3072_0 > kmeansCluster_error_clusterCentroids size:= 3072*float
float *const clusterCentroidskmeans_0_0____0 = (float*) (Shared+1057632);  // kmeansCluster_BroadcastClusterCentroids_clusterCentroidskmeans_0_0 > kmeansCluster_kmeansfunction_clusterCentroids size:= 3072*float
parameters *const par__par__0 = (parameters*) (Shared+270766080);  // read_parameters_par > kmeansCluster_BroadcastStruck_par size:= 16*parameters
parameters *const parError_0_0__par__0 = (parameters*) (Shared+270766080);  // kmeansCluster_BroadcastStruck_parError_0_0 > kmeansCluster_initializeCluster_par size:= 16*parameters
parameters *const parKmeansCluster_16_0__par__0 = (parameters*) (Shared+270766336);  // kmeansCluster_BroadcastStruck_parKmeansCluster_16_0 > kmeansCluster_kmeansfunction_par size:= 16*parameters
parameters *const parInitialization_32_0__par__0 = (parameters*) (Shared+270766592);  // kmeansCluster_BroadcastStruck_parInitialization_32_0 > kmeansCluster_error_par size:= 16*parameters
float *const error__error__0 = (float*) (Shared+1069920);  // kmeansCluster_error_error > kmeansCluster_kmeansfunction_error size:= 4*float

void *computationThread_Core0(void *arg){
	if (arg != NULL) {
		printf("Warning: expecting NULL arguments\n");
	}
	// Begin the execution loop
#ifdef LOOP_SIZE // Case of a finite loop
	int index;
	for(index=0;index<LOOP_SIZE;index++){
#else // Default case of an infinite loop
	while(1){
#endif
		pthread_barrier_wait(&iter_barrier);
		if(stopThreads){
			pthread_exit(NULL);
		}
		readParAndImg(552/*rows*/,479/*columns*/,128/*bands*/,264408/*pixels*/,image__image__0,par__par__0); // read_parameters
		// Broadcast kmeansCluster_BroadcastHsImage
		{
			// memcpy #0
			// memcpy #0
			memcpy(imageKmeans_33844224_0__imag__0+0, image__image__0+0, 33844224*sizeof(float));
		}
		// Broadcast kmeansCluster_BroadcastStruck
		{
			// memcpy #0
			memcpy(parKmeansCluster_16_0__par__0+0, par__par__0+0, 16*sizeof(parameters));
			// memcpy #0
			// memcpy #0
			memcpy(parInitialization_32_0__par__0+0, par__par__0+0, 16*sizeof(parameters));
		}
		initializeCluster(264408/*pixels*/,128/*bands*/,imageInitialization_0_0__ima__0,parError_0_0__par__0,clusterCentroids__clusterCen__0); // kmeansCluster_initializeCluster
		// Broadcast kmeansCluster_BroadcastClusterCentroids
		{
			// memcpy #0
			// memcpy #0
			memcpy(clusterCentroidskmeans_0_0____0+0, clusterCentroids__clusterCen__0+0, 3072*sizeof(float));
		}
		computeErrorInitialization(128/*c*/,parInitialization_32_0__par__0,clusterCentroidsError_3072_0__0,error__error__0); // kmeansCluster_error
		kmeansfunction(552/*rows*/,479/*columns*/,128/*bands*/,264408/*pixels*/,parKmeansCluster_16_0__par__0,imageKmeans_33844224_0__imag__0,error__error__0,clusterCentroidskmeans_0_0____0,assignedCluster__assignedClu__0); // kmeansCluster_kmeansfunction
		writeResults(552/*rows*/,479/*columns*/,assignedCluster__assignedClu__0); // write_results
	}
	return NULL;
}

