/**
 * @file Core0.c
 * @generated by CPrinter
 * @date Tue Aug 13 19:34:27 CEST 2019
 *
 * Code generated for processing element Core0 (ID=0).
 */

#include "preesm_gen.h"
// Core Global Declaration
extern pthread_barrier_t iter_barrier;
extern int stopThreads;

// Core Global Definitions
char Shared[271837040]; //  size:= 271837040*char
char *const FIFO_Head_kmeansCluster_kmea__0 = (char*) (Shared+1057632);  // FIFO_Head_kmeansCluster_kmeansfunction_evaluation_end_previousCentroids > kmeansCluster_kmeansfunction_computeError_init_previousCentroids size:= 12288*char
char *const read_parameters__kmeansClust__0 = (char*) (Shared+0);  // read_parameters > kmeansCluster_BroadcastHsImage size:= 135376896*char
char *const kmeansCluster_BroadcastHsIma__0 = (char*) (Shared+0);  // kmeansCluster_BroadcastHsImage > kmeansCluster_initializeCluster size:= 135376896*char
char *const kmeansCluster_BroadcastHsIma__1 = (char*) (Shared+135376896);  // kmeansCluster_BroadcastHsImage > kmeansCluster_kmeansfunction_BroadcastHsImage size:= 135376896*char
char *const kmeansCluster_kmeansfunction__0 = (char*) (Shared+135376896);  // kmeansCluster_kmeansfunction_BroadcastHsImage > kmeansCluster_kmeansfunction_computeDistance size:= 135376896*char
char *const kmeansCluster_kmeansfunction__1 = (char*) (Shared+0);  // kmeansCluster_kmeansfunction_BroadcastHsImage > kmeansCluster_kmeansfunction_updateCentroids size:= 135376896*char
char *const kmeansCluster_kmeansfunction__2 = (char*) (Shared+270753792);  // kmeansCluster_kmeansfunction_computeDistance > kmeansCluster_kmeansfunction_BroadcastAssignedCluster size:= 1057632*char
char *const kmeansCluster_kmeansfunction__3 = (char*) (Shared+270753792);  // kmeansCluster_kmeansfunction_BroadcastAssignedCluster > kmeansCluster_kmeansfunction_updateCentroids size:= 1057632*char
char *const kmeansCluster_kmeansfunction__4 = (char*) (Shared+135376896);  // kmeansCluster_kmeansfunction_BroadcastAssignedCluster > kmeansCluster_kmeansfunction_evaluation size:= 1057632*char
char *const kmeansCluster_kmeansfunction__5 = (char*) (Shared+0);  // kmeansCluster_kmeansfunction_evaluation > write_results size:= 1057632*char
char *const kmeansCluster_kmeansfunction__6 = (char*) (Shared+271811424);  // kmeansCluster_kmeansfunction_computeError_init_previousCentroids > kmeansCluster_kmeansfunction_computeError size:= 12288*char
char *const kmeansCluster_initializeClus__0 = (char*) (Shared+270753792);  // kmeansCluster_initializeCluster > kmeansCluster_BroadcastClusterCentroids size:= 12288*char
char *const kmeansCluster_BroadcastClust__0 = (char*) (Shared+270753792);  // kmeansCluster_BroadcastClusterCentroids > kmeansCluster_error size:= 12288*char
char *const kmeansCluster_BroadcastClust__1 = (char*) (Shared+271823712);  // kmeansCluster_BroadcastClusterCentroids > kmeansCluster_kmeansfunction_computeDistance size:= 12288*char
char *const kmeansCluster_kmeansfunction__7 = (char*) (Shared+136434528);  // kmeansCluster_kmeansfunction_updateCentroids > kmeansCluster_kmeansfunction_BroadcastClusterCentroids size:= 12288*char
char *const kmeansCluster_kmeansfunction__8 = (char*) (Shared+136434528);  // kmeansCluster_kmeansfunction_BroadcastClusterCentroids > kmeansCluster_kmeansfunction_computeError size:= 12288*char
char *const kmeansCluster_kmeansfunction__9 = (char*) (Shared+1057632);  // kmeansCluster_kmeansfunction_BroadcastClusterCentroids > kmeansCluster_kmeansfunction_evaluation size:= 12288*char
char *const kmeansCluster_kmeansfunction__10 = (char*) (Shared+1069920);  // kmeansCluster_kmeansfunction_evaluation > kmeansCluster_kmeansfunction_evaluation_end_previousCentroids size:= 12288*char
char *const read_parameters__kmeansClust__1 = (char*) (Shared+270766080);  // read_parameters > kmeansCluster_BroadcastStruck size:= 256*char
char *const kmeansCluster_BroadcastStruc__0 = (char*) (Shared+270766080);  // kmeansCluster_BroadcastStruck > kmeansCluster_initializeCluster size:= 256*char
char *const kmeansCluster_BroadcastStruc__1 = (char*) (Shared+270766336);  // kmeansCluster_BroadcastStruck > kmeansCluster_error size:= 256*char
char *const kmeansCluster_BroadcastStruc__2 = (char*) (Shared+271836000);  // kmeansCluster_BroadcastStruck > kmeansCluster_kmeansfunction_BroadcastPar size:= 256*char
char *const kmeansCluster_kmeansfunction__11 = (char*) (Shared+271836000);  // kmeansCluster_kmeansfunction_BroadcastPar > kmeansCluster_kmeansfunction_computeDistance size:= 256*char
char *const kmeansCluster_kmeansfunction__12 = (char*) (Shared+271836256);  // kmeansCluster_kmeansfunction_BroadcastPar > kmeansCluster_kmeansfunction_evaluation size:= 256*char
char *const kmeansCluster_kmeansfunction__13 = (char*) (Shared+271836512);  // kmeansCluster_kmeansfunction_BroadcastPar > kmeansCluster_kmeansfunction_computeError size:= 256*char
char *const kmeansCluster_kmeansfunction__14 = (char*) (Shared+271836768);  // kmeansCluster_kmeansfunction_BroadcastPar > kmeansCluster_kmeansfunction_updateCentroids size:= 256*char
char *const kmeansCluster_error__kmeansC__0 = (char*) (Shared+271837024);  // kmeansCluster_error > kmeansCluster_kmeansfunction_updateCentroids size:= 16*char
char *const kmeansCluster_kmeansfunction__15 = (char*) (Shared+1082208);  // kmeansCluster_kmeansfunction_computeError > kmeansCluster_kmeansfunction_evaluation size:= 16*char
float *const image__image__0 = (float*) (Shared+0);  // read_parameters_image > kmeansCluster_BroadcastHsImage_image size:= 33844224*float
float *const imageInitialization_0_0__ima__0 = (float*) (Shared+0);  // kmeansCluster_BroadcastHsImage_imageInitialization_0_0 > kmeansCluster_initializeCluster_image size:= 33844224*float
float *const imageKmeans_33844224_0__imag__0 = (float*) (Shared+135376896);  // kmeansCluster_BroadcastHsImage_imageKmeans_33844224_0 > kmeansCluster_kmeansfunction_BroadcastHsImage_image size:= 33844224*float
float *const imageDistance_0_0__image__0 = (float*) (Shared+135376896);  // kmeansCluster_kmeansfunction_BroadcastHsImage_imageDistance_0_0 > kmeansCluster_kmeansfunction_computeDistance_image size:= 33844224*float
float *const imageUpdate_33844224_0__imag__0 = (float*) (Shared+0);  // kmeansCluster_kmeansfunction_BroadcastHsImage_imageUpdate_33844224_0 > kmeansCluster_kmeansfunction_updateCentroids_image size:= 33844224*float
int *const assignedClusterp__assignedCl__0 = (int*) (Shared+270753792);  // kmeansCluster_kmeansfunction_computeDistance_assignedClusterp > kmeansCluster_kmeansfunction_BroadcastAssignedCluster_assignedCluster size:= 264408*int
int *const assignedClusterUpdate_0_0__a__0 = (int*) (Shared+270753792);  // kmeansCluster_kmeansfunction_BroadcastAssignedCluster_assignedClusterUpdate_0_0 > kmeansCluster_kmeansfunction_updateCentroids_assignedClusterp size:= 264408*int
int *const assignedClusterevaluation_26__0 = (int*) (Shared+135376896);  // kmeansCluster_kmeansfunction_BroadcastAssignedCluster_assignedClusterevaluation_264408_0 > kmeansCluster_kmeansfunction_evaluation_assignedClusterp size:= 264408*int
int *const assignedCluster__assignedClu__0 = (int*) (Shared+0);  // kmeansCluster_kmeansfunction_evaluation_assignedCluster > write_results_assignedCluster size:= 264408*int
float *const init_out__previousCentroids__0 = (float*) (Shared+271811424);  // kmeansCluster_kmeansfunction_computeError_init_previousCentroids_init_out > kmeansCluster_kmeansfunction_computeError_previousCentroids size:= 3072*float
float *const clusterCentroids__clusterCen__0 = (float*) (Shared+270753792);  // kmeansCluster_initializeCluster_clusterCentroids > kmeansCluster_BroadcastClusterCentroids_clusterCentroids size:= 3072*float
float *const clusterCentroidsError_3072_0__0 = (float*) (Shared+270753792);  // kmeansCluster_BroadcastClusterCentroids_clusterCentroidsError_3072_0 > kmeansCluster_error_clusterCentroids size:= 3072*float
float *const clusterCentroidskmeans_0_0____0 = (float*) (Shared+271823712);  // kmeansCluster_BroadcastClusterCentroids_clusterCentroidskmeans_0_0 > kmeansCluster_kmeansfunction_computeDistance_clusterCentroids size:= 3072*float
float *const clusterCentroids__clusterCen__1 = (float*) (Shared+136434528);  // kmeansCluster_kmeansfunction_updateCentroids_clusterCentroids > kmeansCluster_kmeansfunction_BroadcastClusterCentroids_clusterCentroids size:= 3072*float
float *const clusterCentroidsError_0_0__c__0 = (float*) (Shared+136434528);  // kmeansCluster_kmeansfunction_BroadcastClusterCentroids_clusterCentroidsError_0_0 > kmeansCluster_kmeansfunction_computeError_clusterCentroids size:= 3072*float
float *const clusterCentroidsevaluation_3__0 = (float*) (Shared+1057632);  // kmeansCluster_kmeansfunction_BroadcastClusterCentroids_clusterCentroidsevaluation_3072_0 > kmeansCluster_kmeansfunction_evaluation_clusterCentroids size:= 3072*float
float *const previousCentroids__end_in__0 = (float*) (Shared+1069920);  // kmeansCluster_kmeansfunction_evaluation_previousCentroids > kmeansCluster_kmeansfunction_evaluation_end_previousCentroids_end_in size:= 3072*float
parameters *const par__par__0 = (parameters*) (Shared+270766080);  // read_parameters_par > kmeansCluster_BroadcastStruck_par size:= 16*parameters
parameters *const parError_0_0__par__0 = (parameters*) (Shared+270766080);  // kmeansCluster_BroadcastStruck_parError_0_0 > kmeansCluster_initializeCluster_par size:= 16*parameters
parameters *const parInitialization_32_0__par__0 = (parameters*) (Shared+270766336);  // kmeansCluster_BroadcastStruck_parInitialization_32_0 > kmeansCluster_error_par size:= 16*parameters
parameters *const parKmeansCluster_16_0__par__0 = (parameters*) (Shared+271836000);  // kmeansCluster_BroadcastStruck_parKmeansCluster_16_0 > kmeansCluster_kmeansfunction_BroadcastPar_par size:= 16*parameters
parameters *const parDistance_0_0__par__0 = (parameters*) (Shared+271836000);  // kmeansCluster_kmeansfunction_BroadcastPar_parDistance_0_0 > kmeansCluster_kmeansfunction_computeDistance_par size:= 16*parameters
parameters *const parEvaluation_16_0__par__0 = (parameters*) (Shared+271836256);  // kmeansCluster_kmeansfunction_BroadcastPar_parEvaluation_16_0 > kmeansCluster_kmeansfunction_evaluation_par size:= 16*parameters
parameters *const parError_32_0__par__0 = (parameters*) (Shared+271836512);  // kmeansCluster_kmeansfunction_BroadcastPar_parError_32_0 > kmeansCluster_kmeansfunction_computeError_par size:= 16*parameters
parameters *const parUpdate_48_0__par__0 = (parameters*) (Shared+271836768);  // kmeansCluster_kmeansfunction_BroadcastPar_parUpdate_48_0 > kmeansCluster_kmeansfunction_updateCentroids_par size:= 16*parameters
float *const error__error__0 = (float*) (Shared+271837024);  // kmeansCluster_error_error > kmeansCluster_kmeansfunction_updateCentroids_error size:= 4*float
float *const error__error__1 = (float*) (Shared+1082208);  // kmeansCluster_kmeansfunction_computeError_error > kmeansCluster_kmeansfunction_evaluation_error size:= 4*float

void *computationThread_Core0(void *arg){
	if (arg != NULL) {
		printf("Warning: expecting NULL arguments\n");
	}
	// Initialisation(s)
	fifoInit(FIFO_Head_kmeansCluster_kmea__0, 12288*sizeof(char), NULL, 0);

	// Begin the execution loop
#ifdef LOOP_SIZE // Case of a finite loop
	int index;
	for(index=0;index<LOOP_SIZE;index++){
#else // Default case of an infinite loop
	while(1){
#endif
		pthread_barrier_wait(&iter_barrier);
		if(stopThreads){
			pthread_exit(NULL);
		}
		fifoPop(init_out__previousCentroids__0, FIFO_Head_kmeansCluster_kmea__0, 12288*sizeof(char), NULL, 0);
		readParAndImg(552/*rows*/,479/*columns*/,128/*bands*/,264408/*pixels*/,image__image__0,par__par__0); // read_parameters
		// Broadcast kmeansCluster_BroadcastHsImage
		{
			// memcpy #0
			// memcpy #0
			memcpy(imageKmeans_33844224_0__imag__0+0, image__image__0+0, 33844224*sizeof(float));
		}
		// Broadcast kmeansCluster_BroadcastStruck
		{
			// memcpy #0
			// memcpy #0
			memcpy(parInitialization_32_0__par__0+0, par__par__0+0, 16*sizeof(parameters));
			// memcpy #0
			memcpy(parKmeansCluster_16_0__par__0+0, par__par__0+0, 16*sizeof(parameters));
		}
		// Broadcast kmeansCluster_kmeansfunction_BroadcastPar
		{
			// memcpy #0
			// memcpy #0
			memcpy(parEvaluation_16_0__par__0+0, parKmeansCluster_16_0__par__0+0, 16*sizeof(parameters));
			// memcpy #0
			memcpy(parError_32_0__par__0+0, parKmeansCluster_16_0__par__0+0, 16*sizeof(parameters));
			// memcpy #0
			memcpy(parUpdate_48_0__par__0+0, parKmeansCluster_16_0__par__0+0, 16*sizeof(parameters));
		}
		initializeCluster(264408/*pixels*/,128/*bands*/,imageInitialization_0_0__ima__0,parError_0_0__par__0,clusterCentroids__clusterCen__0); // kmeansCluster_initializeCluster
		// Broadcast kmeansCluster_kmeansfunction_BroadcastHsImage
		{
			// memcpy #0
			// memcpy #0
			memcpy(imageUpdate_33844224_0__imag__0+0, imageKmeans_33844224_0__imag__0+0, 33844224*sizeof(float));
		}
		// Broadcast kmeansCluster_BroadcastClusterCentroids
		{
			// memcpy #0
			// memcpy #0
			memcpy(clusterCentroidskmeans_0_0____0+0, clusterCentroids__clusterCen__0+0, 3072*sizeof(float));
		}
		computeErrorInitialization(128/*c*/,parInitialization_32_0__par__0,clusterCentroidsError_3072_0__0,error__error__0); // kmeansCluster_error
		computeDistance(264408/*pixels*/,128/*bands*/,552/*rows*/,479/*columns*/,imageDistance_0_0__image__0,parDistance_0_0__par__0,clusterCentroidskmeans_0_0____0,assignedClusterp__assignedCl__0); // kmeansCluster_kmeansfunction_computeDistance
		// Broadcast kmeansCluster_kmeansfunction_BroadcastAssignedCluster
		{
			// memcpy #0
			// memcpy #0
			memcpy(assignedClusterevaluation_26__0+0, assignedClusterp__assignedCl__0+0, 264408*sizeof(int));
		}
		updateClusterCentroids(264408/*pixels*/,128/*bands*/,552/*rows*/,479/*columns*/,assignedClusterUpdate_0_0__a__0,parUpdate_48_0__par__0,imageUpdate_33844224_0__imag__0,clusterCentroids__clusterCen__1,error__error__0); // kmeansCluster_kmeansfunction_updateCentroids
		// Broadcast kmeansCluster_kmeansfunction_BroadcastClusterCentroids
		{
			// memcpy #0
			// memcpy #0
			memcpy(clusterCentroidsevaluation_3__0+0, clusterCentroids__clusterCen__1+0, 3072*sizeof(float));
		}
		computeError(128/*c*/,parError_32_0__par__0,clusterCentroidsError_0_0__c__0,init_out__previousCentroids__0,error__error__1); // kmeansCluster_kmeansfunction_computeError
		evaluate(552/*rows*/,479/*columns*/,128/*bands*/,parEvaluation_16_0__par__0,error__error__1,clusterCentroidsevaluation_3__0,assignedClusterevaluation_26__0,assignedCluster__assignedClu__0,previousCentroids__end_in__0); // kmeansCluster_kmeansfunction_evaluation
		fifoPush(previousCentroids__end_in__0, FIFO_Head_kmeansCluster_kmea__0, 12288*sizeof(char), NULL, 0);
		writeResults(552/*rows*/,479/*columns*/,assignedCluster__assignedClu__0); // write_results
	}
	return NULL;
}

